!function(t){t(window).on("load",function(){t("html").addClass("colorpicker-ready")}),wp.customize.controlConstructor["colormag-background"]=wp.customize.Control.extend({ready:function(){"use strict";this.initColorMagBackgroundControl()},initColorMagBackgroundControl:function(){var r=this,t=r.setting._value,e=r.container.find(".colormag-color-picker-alpha");!_.isUndefined(t["background-image"])&&""!==t["background-image"]||(r.container.find(".customize-control-content > .background-repeat").hide(),r.container.find(".customize-control-content > .background-position").hide(),r.container.find(".customize-control-content > .background-size").hide(),r.container.find(".customize-control-content > .background-attachment").hide()),e.wpColorPicker({change:function(){jQuery("html").hasClass("colorpicker-ready")&&setTimeout(function(){r.saveValue("background-color",e.val())},100)},clear:function(t){jQuery(t.target).closest(".wp-picker-input-wrap").find(".wp-color-picker")[0]&&r.saveValue("background-color","")}}),r.container.on("click",".background-image-upload-button, .thumbnail-image img",function(t){var i=wp.media({multiple:!1}).open().on("select",function(){var t,e,n,o=i.state().get("selection").first(),a=o.toJSON().sizes.full.url;_.isUndefined(o.toJSON().sizes.medium)?_.isUndefined(o.toJSON().sizes.thumbnail)||(a=o.toJSON().sizes.thumbnail.url):a=o.toJSON().sizes.medium.url,t=o.toJSON().sizes.full.url,o.toJSON().id,o.toJSON().width,o.toJSON().height,""!==t&&r.container.find(".customize-control-content > .background-repeat, .customize-control-content > .background-position, .customize-control-content > .background-size, .customize-control-content > .background-attachment").show(),r.saveValue("background-image",t),e=r.container.find(".placeholder, .thumbnail"),n=r.container.find(".background-image-upload-remove-button"),e.length&&e.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+a+'" alt="" />'),n.length&&n.show()});t.preventDefault()}),r.container.on("click",".background-image-upload-remove-button",function(t){var e,n;t.preventDefault(),r.saveValue("background-image",""),e=r.container.find(".placeholder, .thumbnail"),n=r.container.find(".background-image-upload-remove-button"),r.container.find(".customize-control-content > .background-repeat").hide(),r.container.find(".customize-control-content > .background-position").hide(),r.container.find(".customize-control-content > .background-size").hide(),r.container.find(".customize-control-content > .background-attachment").hide(),e.length&&e.removeClass().addClass("placeholder").html(ColorMagCustomizerControlBackground.placeholder),n.length&&n.hide()}),r.container.on("change",".background-repeat select",function(){r.saveValue("background-repeat",jQuery(this).val())}),r.container.on("change",".background-position select",function(){r.saveValue("background-position",jQuery(this).val())}),r.container.on("change",".background-size select",function(){r.saveValue("background-size",jQuery(this).val())}),r.container.on("change",".background-attachment select",function(){r.saveValue("background-attachment",jQuery(this).val())})},saveValue:function(t,e){var n=this,o=jQuery("#customize-control-"+n.id.replace("[","-").replace("]","")+" .background-hidden-value"),a=n.setting._value;a[t]=e,jQuery(o).attr("value",JSON.stringify(a)).trigger("change"),n.setting.set(a)}})}(jQuery),wp.customize.controlConstructor["colormag-buttonset"]=wp.customize.Control.extend({ready:function(){"use strict";var t=this;this.container.on("click","input",function(){t.setting.set(jQuery(this).val())})}}),function(t){t(window).on("load",function(){t("html").addClass("colorpicker-ready")}),wp.customize.controlConstructor["colormag-color"]=wp.customize.Control.extend({ready:function(){"use strict";var o=this;this.container.find(".colormag-color-picker-alpha").wpColorPicker({change:function(t,e){var n=e.color.toString();jQuery("html").hasClass("colorpicker-ready")&&o.setting.set(n)}})}})}(jQuery),wp.customize.controlConstructor["colormag-dropdown-categories"]=wp.customize.Control.extend({ready:function(){"use strict";var t=this;this.container.on("change","select",function(){t.setting.set(jQuery(this).val())})}}),wp.customize.controlConstructor["colormag-editor"]=wp.customize.Control.extend({ready:function(){"use strict";var t="editor_"+this.id;wp.editor.initialize(t,{tinymce:{wpautop:!0},quicktags:!0,mediaButtons:!0})},onChangeActive:function(t,e){"use strict";var n,o=this,a="editor_"+o.id,i=o.container.find("textarea");(n=tinyMCE.get(a))&&n.onChange.add(function(t){var e;t.save(),e=n.getContent(),i.val(e).trigger("change"),wp.customize.instance(o.id).set(e)})}}),function(u){wp.customize.controlConstructor["colormag-group"]=wp.customize.Control.extend({ready:function(){"use strict";this.registerToggleEvents(),this.container.on("colormag_settings_changed",this.onOptionChange)},registerToggleEvents:function(){var l=this;u(".wp-full-overlay-sidebar-content").click(function(t){u(t.target).closest(".colormag-field-settings-modal").length||u(".colormag-group-toggle-icon.open").trigger("click")}),l.container.on("click",".colormag-group-wrap .colormag-group-toggle-icon",function(t){t.preventDefault(),t.stopPropagation();var e=u(this),n=e.closest(".customize-control-colormag-group"),o=n.find(".colormag-field-settings-modal").data("loaded"),a=n.parents(".control-section");if(e.hasClass("open"))n.find(".colormag-field-settings-modal").hide();else{var i=a.find(".colormag-group-toggle-icon.open");if(0<i.length&&i.trigger("click"),o)n.find(".colormag-field-settings-modal").show();else{var r=l.params.colormag_fields,c=u(ColorMagCustomizerControlGroup.group_modal_tmpl),s=u("#customize-footer-actions .active").attr("data-device");n.find(".colormag-field-settings-wrap").append(c),n.find(".colormag-fields-wrap").attr("data-control",l.params.name),l.colormag_render_field(n,r,l),n.find(".colormag-field-settings-modal").show(),"mobile"==s?(u(".control-wrap.mobile").addClass("active"),u(".responsive-switchers .preview-mobile").addClass("active")):"tablet"==s?(u(".control-wrap.tablet").addClass("active"),u(".responsive-switchers .preview-tablet").addClass("active")):(u(".control-wrap.desktop").addClass("active"),u(".responsive-switchers .preview-desktop").addClass("active"))}}e.toggleClass("open")}),l.container.on("click",".colormag-group-wrap > .customizer-text",function(t){t.preventDefault(),t.stopPropagation(),u(this).find(".colormag-group-toggle-icon").trigger("click")})},colormag_render_field:function(t,e,n){var o=this,a=t.find(".colormag-fields-wrap"),i="",r=[],c=o.isJSONString(n.params.value)?JSON.parse(n.params.value):{};if(void 0!==e.tabs){var s=0;i+='<div id="'+n.params.name+'-tabs" class="colormag-group-tabs">',i+='<ul class="colormag-group-list">',_.each(e.tabs,function(t,e){var n="";0===s&&(n="active"),i+='<li class="'+n+'"><a href="#tab-'+e+'"><span>'+e+"</span></a></li>",s++}),i+="</ul>",i+='<div class="colormag-tab-content" >',_.each(e.tabs,function(t,e){var n=o.generateFieldHtml(t,c);i+='<div id="tab-'+e+'" class="tab">',i+=n.html,_.each(n.controls,function(t,e){r.push({key:t.key,value:t.value,name:t.name})}),i+="</div>"}),i+="</div>",i+="</div>",a.html(i),u("#"+n.params.name+"-tabs").tabs()}else{var l=o.generateFieldHtml(e,c);i+=l.html,_.each(l.controls,function(t,e){r.push({key:t.key,value:t.value,name:t.name})}),a.html(i)}_.each(r,function(t,e){switch(t.key){case"colormag-color":o.initColorControl(a,n,t.name);break;case"colormag-background":o.initBackgroundControl(n,t,t.name);break;case"colormag-typography":o.initTypographyControl(n,t,t.name)}}),t.find(".colormag-field-settings-modal").data("loaded",!0)},isJSONString:function(t){try{JSON.parse(t)}catch(t){return!1}return!0},generateFieldHtml:function(t,e){var u="",d=[];_.each(t,function(t,e){var n=wp.customize.control(t.name)?wp.customize.control(t.name).params.value:"",o=t.control,a="customize-control-"+o+"-content",i=wp.template(a),r=n||t.default,c="",s="";t.value=r,t.title=t.label,_.each(t.data_attrs,function(t,e){c+=" data-"+e+' ="'+t+'"'}),_.each(t.input_attrs,function(t,e){s+=e+' ="'+t+'"'}),t.dataAttrs=c,t.inputAttrs=s,d.push({key:o,value:r,name:t.name});var l="";["colormag-typography"].includes(t.control)&&(l="has-responsive-switchers"),u+='<li id="customize-control-'+t.name+'" class="customize-control '+l+" customize-control-"+t.control+'" >',u+=i(t),u+="</li>"});var n=new Object;return n.controls=d,n.html=u,n},onOptionChange:function(t,e,n,o,a){u(".hidden-field-"+a).val(o),wp.customize.control(a).setting.set(o)},initColorControl:function(t,e,o){var a=this;t.find(".customize-control-colormag-color .colormag-color-picker-alpha").wpColorPicker({change:function(t,e){if(void 0!==t.originalEvent||void 0!==e.color._alpha){var n=u(t.target).closest(".wp-picker-input-wrap").find(".wp-color-picker")[0];o=(o=u(n).parents(".customize-control").attr("id")).replace("customize-control-",""),u(n).val(e.color.toString()),a.container.trigger("colormag_settings_changed",[a,u(n),e.color.toString(),o])}},clear:function(t){var e=u(t.target).closest(".wp-picker-input-wrap").find(".wp-color-picker")[0];o=(o=u(e).parents(".customize-control").attr("id")).replace("customize-control-",""),u(e).val(""),a.container.trigger("colormag_settings_changed",[a,u(e),"",o]),wp.customize.previewer.refresh()}})},initBackgroundControl:function(c,t,s){c.setting._value;var e=t.name,n=c.container.find(".colormag-color-picker-alpha"),l=c.container.find("#customize-control-"+e);!_.isUndefined(t.value["background-image"])&&""!==t.value["background-image"]||(l.find(".customize-control-content > .background-repeat").hide(),l.find(".customize-control-content > .background-position").hide(),l.find(".customize-control-content > .background-size").hide(),l.find(".customize-control-content > .background-attachment").hide()),n.wpColorPicker({change:function(){if(u("html").hasClass("colorpicker-ready")){var t=u(this);setTimeout(function(){c.saveBackgroundValue("background-color",n.val(),t,s)},100)}},clear:function(t){var e=u(t.target).closest(".wp-picker-input-wrap").find(".wp-color-picker")[0];e&&c.saveBackgroundValue("background-color","",u(e),s),wp.customize.previewer.refresh()}}),l.on("click",".background-image-upload-button, .thumbnail-image img",function(t){var i=u(this),r=wp.media({multiple:!1}).open().on("select",function(){var t,e,n,o=r.state().get("selection").first(),a=o.toJSON().sizes.full.url;_.isUndefined(o.toJSON().sizes.medium)?_.isUndefined(o.toJSON().sizes.thumbnail)||(a=o.toJSON().sizes.thumbnail.url):a=o.toJSON().sizes.medium.url,t=o.toJSON().sizes.full.url,o.toJSON().id,o.toJSON().width,o.toJSON().height,""!==t&&l.find(".customize-control-content > .background-repeat, .customize-control-content > .background-position, .customize-control-content > .background-size, .customize-control-content > .background-attachment").show(),c.saveBackgroundValue("background-image",t,i,s),e=l.find(".placeholder, .thumbnail"),n=l.find(".background-image-upload-remove-button"),e.length&&e.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+a+'" alt="" />'),n.length&&n.show()});t.preventDefault()}),l.on("click",".background-image-upload-remove-button",function(t){var e,n;t.preventDefault(),c.saveBackgroundValue("background-image","",u(this)),e=l.find(".placeholder, .thumbnail"),n=l.find(".background-image-upload-remove-button"),l.find(".customize-control-content > .background-repeat").hide(),l.find(".customize-control-content > .background-position").hide(),l.find(".customize-control-content > .background-size").hide(),l.find(".customize-control-content > .background-attachment").hide(),e.length&&e.removeClass().addClass("placeholder").html(ColorMagCustomizerControlBackground.placeholder),n.length&&n.hide()}),l.on("change",".background-repeat select",function(){c.saveBackgroundValue("background-repeat",u(this).val(),u(this),s)}),l.on("change",".background-position select",function(){c.saveBackgroundValue("background-position",u(this).val(),u(this),s)}),l.on("change",".background-size select",function(){c.saveBackgroundValue("background-size",u(this).val(),u(this),s)}),l.on("change",".background-attachment select",function(){c.saveBackgroundValue("background-attachment",u(this).val(),u(this),s)})},saveBackgroundValue:function(t,e,n,o){var a=u("#customize-control-"+this.id.replace("[","-").replace("]","")+" .background-hidden-value"),i=JSON.parse(a.val());i[t]=e,u(a).attr("value",JSON.stringify(i)).trigger("change"),o=(o=u(n).parents(".customize-control").attr("id")).replace("customize-control-",""),this.container.trigger("colormag_settings_changed",[this,n,i,o])},initTypographyControl:function(t,e,n){t.setting._value;var o=e.name,a=t.container.find("#customize-control-"+o);a.on("change",".font-style select",function(){t.saveTypographyValue("font-style",u(this).val(),u(this),n)}),a.on("change",".text-transform select",function(){t.saveTypographyValue("text-transform",u(this).val(),u(this),n)}),a.on("change",".text-decoration select",function(){t.saveTypographyValue("text-decoration",u(this).val(),u(this),n)})},saveTypographyValue:function(t,e,n,o){var a=u("#customize-control-"+this.id.replace("[","-").replace("]","")+" .typography-hidden-value"),i=JSON.parse(a.val());i[t]=e,u(a).attr("value",JSON.stringify(i)).trigger("change"),o=(o=u(n).parents(".customize-control").attr("id")).replace("customize-control-",""),this.container.trigger("colormag_settings_changed",[this,n,i,o])}})}(jQuery),wp.customize.controlConstructor["colormag-radio-image"]=wp.customize.Control.extend({ready:function(){"use strict";var t=this;this.container.on("click","input",function(){t.setting.set(jQuery(this).val())})}}),wp.customize.controlConstructor["colormag-slider"]=wp.customize.Control.extend({ready:function(){"use strict";var e=this;jQuery("input[type=range]").on("input change",function(){var t=jQuery(this).attr("value"),e=jQuery(this).closest(".slider-wrapper").find(".colormag-range-value .value");e.val(t),e.change()}),jQuery(".colormag-slider-reset").click(function(){var t=jQuery(this).closest(".slider-wrapper"),e=t.find("input[type=range]"),n=t.find(".colormag-range-value .value"),o=e.data("reset_value");e.val(o),n.val(o),n.change()}),this.container.on("input change","input[type=number]",function(){var t=jQuery(this).val();jQuery(this).closest(".slider-wrapper").find("input[type=range]").val(t),e.setting.set(t)})}}),wp.customize.controlConstructor["colormag-toggle"]=wp.customize.Control.extend({ready:function(){"use strict";var t=this,e=t.setting._value;this.container.on("change","input",function(){e=!!jQuery(this).is(":checked"),t.setting.set(e)})}}),wp.customize.controlConstructor["colormag-typography"]=wp.customize.Control.extend({ready:function(){"use strict";var t=this;t.renderFontSelector(),t.renderVariantSelector(),t.renderSubsetSelector(),t.container.on("change",".font-style select",function(){t.saveValue("font-style",jQuery(this).val())}),t.container.on("change",".text-transform select",function(){t.saveValue("text-transform",jQuery(this).val())}),t.container.on("change",".text-decoration select",function(){t.saveValue("text-decoration",jQuery(this).val())}),t.container.on("change keyup paste input",".font-size input",function(){t.updateFontSize()}),t.container.on("change keyup paste input",".line-height input",function(){t.updateLineHeight()}),t.container.on("change keyup paste input",".letter-spacing input",function(){t.updateLetterSpacing()})},renderFontSelector:function(){var t,e=this,n=e.selector+" .font-family select",o=[],a=[],i=[],r=e.setting._value,c=e.getFonts();_.isUndefined(c.standard)||_.each(c.standard,function(t){o.push({id:t.family.replace(/&quot;/g,"&#39"),text:t.label})}),_.isUndefined(c.google)||_.each(c.google,function(t){a.push({id:t.family,text:t.label})}),data=[{text:c.standardfontslabel,children:o},{text:c.googlefontslabel,children:a}],_.isUndefined(c.custom)||(_.each(c.custom,function(t){i.push({id:t.family,text:t.label})}),data.push({text:c.customfontslabel,children:i})),t=jQuery(n).selectWoo({data:data,width:"100%"}),r["font-family"]&&t.val(r["font-family"].replace(/'/g,'"')).trigger("change"),t.on("change",function(){e.saveValue("font-family",jQuery(this).val()),e.renderVariantSelector(),e.renderSubsetSelector()})},getFonts:function(){return _.isUndefined(ColorMagCustomizerControlTypography)?{google:[],standard:[]}:ColorMagCustomizerControlTypography},renderVariantSelector:function(){var t,e=this,n=e.setting._value,o=n["font-family"],a=e.getVariants(o),i=e.selector+" .font-weight select",r=[],c=!1;!1!==a?(jQuery(e.selector+" .font-weight").show(),_.each(a,function(t){n["font-weight"]===t.id&&(c=!0),r.push({id:t.id,text:t.label})}),c||(n["font-weight"]="regular"),jQuery(i).hasClass("select2-hidden-accessible")&&(jQuery(i).selectWoo("destroy"),jQuery(i).empty()),(t=jQuery(i).selectWoo({data:r,width:"100%"})).val(n["font-weight"]).trigger("change"),t.on("change",function(){e.saveValue("font-weight",jQuery(this).val())})):jQuery(e.selector+" .font-weight").hide()},getVariants:function(e){var t=this.getFonts(),n=!1;return _.each(t.standard,function(t){if(e&&t.family===e.replace(/'/g,'"'))return n=t.variants}),_.each(t.google,function(t){if(t.family===e)return n=t.variants}),_.isUndefined(t.custom)||_.each(t.custom,function(t){if(t.custom===e)return n=t.variants}),n},renderSubsetSelector:function(){var t,e=this,n=e.setting._value,o=n["font-family"],a=e.getSubsets(o),i=e.selector+" .subsets select",r=[],c=n.subsets;!1!==a?(jQuery(e.selector+" .subsets").show(),_.each(a,function(e){_.isObject(c)&&-1===c.indexOf(e.id)&&(c=_.reject(c,function(t){return t===e.id})),r.push({id:e.id,text:e.label})})):jQuery(e.selector+" .subsets").hide(),jQuery(i).hasClass("select2-hidden-accessible")&&(jQuery(i).selectWoo("destroy"),jQuery(i).empty()),(t=jQuery(i).selectWoo({data:r,width:"100%"})).val(c).trigger("change"),t.on("change",function(){e.saveValue("subsets",jQuery(this).val())})},getSubsets:function(e){var n=!1,t=this.getFonts();return _.each(t.google,function(t){if(t.family===e)return n=t.subsets}),n},saveValue:function(t,e){var n=this.container.find(".typography-hidden-value"),o=this.setting._value;o[t]=e,jQuery(n).attr("value",JSON.stringify(o)).trigger("change"),this.setting.set(o)},updateFontSize:function(){var t=this.setting._value,e=this.container.find(".typography-hidden-value"),n={"font-size":{}};this.container.find(".font-size .control-wrap").each(function(){var t=jQuery(this).find("input").val(),e=jQuery(this).find("input").data("device");n["font-size"][e]=t}),jQuery.extend(t,n),jQuery(e).attr("value",JSON.stringify(t)).trigger("change"),this.setting.set(t)},updateLineHeight:function(){var t=this.setting._value,e=this.container.find(".typography-hidden-value"),n={"line-height":{}};this.container.find(".line-height .control-wrap").each(function(){var t=jQuery(this).find("input").val(),e=jQuery(this).find("input").data("device");n["line-height"][e]=t}),jQuery.extend(t,n),jQuery(e).attr("value",JSON.stringify(t)).trigger("change"),this.setting.set(t)},updateLetterSpacing:function(){var t=this.setting._value,e=this.container.find(".typography-hidden-value"),n={"letter-spacing":{}};this.container.find(".letter-spacing .control-wrap").each(function(){var t=jQuery(this).find("input").val(),e=jQuery(this).find("input").data("device");n["letter-spacing"][e]=t}),jQuery.extend(t,n),jQuery(e).attr("value",JSON.stringify(t)).trigger("change"),this.setting.set(t)}});